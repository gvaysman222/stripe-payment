# Stripe Payment Django Project

Это тестовый проект для интеграции с платёжной системой [Stripe](https://stripe.com/docs) с использованием Django. Проект демонстрирует следующие функции:

- **Модель Item:** Товары с полями `name`, `description`, `price` и `currency`.
- **Оплата товара:** Оплата отдельного товара через Stripe Checkout Session.
- **Корзина:** Возможность добавления товаров в корзину и оформление заказа.
- **Модель Order:** Заказ, объединяющий несколько товаров, с поддержкой расчёта общей суммы, а также моделей **Discount** и **Tax** (бонусная функциональность).
- **Оплата заказа:** Оплата заказа через Stripe PaymentIntent с динамическим выбором Stripe ключей в зависимости от валюты (USD/EUR).
- **Динамический вывод валюты:** Вывод символа доллара или евро в шаблонах в зависимости от значения поля `currency`.

## Установка и запуск

### 1. Клонирование репозитория

```bash
git clone https://github.com/yourusername/stripe-payment.git
cd stripe-payment
```

### 2. Создание виртуального окружения и установка зависимостей

```bash
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

### 3. Конфигурация переменных окружения

```ini
SECRET_KEY=your-secret-key #Django secret key
DEBUG=True #Django debug mode
ALLOWED_HOSTS=localhost,127.0.0.1 #Django allowed hosts
STRIPE_PUBLISHABLE_KEY=pk_test_USD_XXXXXXXXXXXXXXXXXXXX #Stripe publishable key
STRIPE_SECRET_KEY=sk_test_USD_XXXXXXXXXXXXXXXXXXXX #Stripe secret key
```

### 4. Миграции и создание суперпользователя

```bash
python manage.py makemigrations
python manage.py migrate
python manage.py createsuperuser
```

### 5. Запуск сервера

```bash
python manage.py runserver
```

### 6. Тестирование функциональности

#### Главная страница и список товаров
- Перейдите по адресу: [http://127.0.0.1:8000/](http://127.0.0.1:8000/).
- На главной странице отображается список товаров. Для каждого товара доступны кнопки:
  - **Подробнее** – просмотр информации о товаре и оплата через Stripe Checkout Session.
  - **Добавить в корзину** – добавление товара в корзину.

#### Корзина и оформление заказа
- После нажатия кнопки **Добавить в корзину** товар сохраняется в сессии.
- Перейдите на страницу корзины по адресу: [http://127.0.0.1:8000/cart/](http://127.0.0.1:8000/cart/), где будут отображаться добавленные товары с динамическим выводом символа валюты (USD или EUR).
- Нажмите кнопку **Оформить заказ**, чтобы создать заказ на основе содержимого корзины и перейти на страницу оплаты заказа.
- На странице заказа (например, [http://127.0.0.1:8000/order/1/](http://127.0.0.1:8000/order/1/)) используется Stripe PaymentIntent через Stripe Elements для завершения оплаты. Для тестирования используйте тестовую карту (например, **4242 4242 4242 4242**).

#### Админ-панель
- Доступна по адресу: [http://127.0.0.1:8000/admin/](http://127.0.0.1:8000/admin/).
- Здесь можно управлять моделями: **Item**, **Order**, **Discount**, **Tax**.

#### Дополнительная информация
- **Stripe тестовый режим:** Все платежи выполняются в тестовом режиме. Используйте тестовые ключи и тестовые данные карт, предоставленные Stripe.
- **Бонусные задачи:** Реализована поддержка дополнительных моделей (**Order**, **Discount**, **Tax**), динамический выбор Stripe ключей в зависимости от валюты и корректный вывод символов валюты в шаблонах.

### Контакты
- Если у вас возникнут вопросы или предложения по улучшению проекта, пожалуйста, создайте issue или свяжитесь со мной.
- [Telegram](https://t.me/Gvaysman).